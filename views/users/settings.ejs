<% layout("/layouts/boilerplate")%>

<div class="container mt-5">
  <div class="row">
    <div class="col-md-3">
      <!-- Settings Navigation -->
      <div class="card">
        <div class="card-header">
          <h5 class="mb-0">Settings</h5>
        </div>
        <div class="list-group list-group-flush">
          <a href="#profile" class="list-group-item list-group-item-action active" data-bs-toggle="list">
            <i class="fa-solid fa-user me-2"></i>Profile
          </a>
          <a href="#security" class="list-group-item list-group-item-action" data-bs-toggle="list">
            <i class="fa-solid fa-shield me-2"></i>Security
          </a>
          <a href="#notifications" class="list-group-item list-group-item-action" data-bs-toggle="list">
            <i class="fa-solid fa-bell me-2"></i>Notifications
          </a>
          <a href="#privacy" class="list-group-item list-group-item-action" data-bs-toggle="list">
            <i class="fa-solid fa-eye me-2"></i>Privacy
          </a>
        </div>
      </div>
    </div>
    
    <div class="col-md-9">
      <div class="tab-content">
        <!-- Profile Settings -->
        <div class="tab-pane fade show active" id="profile">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Profile Settings</h5>
            </div>
            <div class="card-body">
              <form action="/profile/edit?_method=PUT" method="POST" class="needs-validation" novalidate>
                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="username" class="form-label">Username</label>
                    <input 
                      type="text" 
                      class="form-control" 
                      id="username" 
                      name="username" 
                      value="<%= currUser ? currUser.username : '' %>" 
                      required
                      minlength="3"
                      maxlength="30"
                    />
                    <div class="invalid-feedback">Please provide a valid username.</div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input 
                      type="email" 
                      class="form-control" 
                      id="email" 
                      name="email" 
                      value="<%= currUser ? currUser.email : '' %>" 
                      required
                    />
                    <div class="invalid-feedback">Please provide a valid email.</div>
                  </div>
                </div>
                <div class="mb-3">
                  <label for="bio" class="form-label">Bio</label>
                  <textarea 
                    class="form-control" 
                    id="bio" 
                    name="bio" 
                    rows="3"
                    maxlength="500"
                    placeholder="Tell us about yourself..."
                  ><%= currUser && currUser.bio ? currUser.bio : '' %></textarea>
                  <div class="form-text">Maximum 500 characters</div>
                </div>
                <button type="submit" class="btn btn-primary">Update Profile</button>
              </form>
            </div>
          </div>
        </div>
        
        <!-- Security Settings -->
        <div class="tab-pane fade" id="security">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Security Settings</h5>
            </div>
            <div class="card-body">
              <div class="mb-4">
                <h6>Change Password</h6>
                <p class="text-muted">Update your password to keep your account secure.</p>
                <a href="/profile/change-password" class="btn btn-outline-primary">Change Password</a>
              </div>
              
              <div class="mb-4">
                <h6>Two-Factor Authentication</h6>
                <p class="text-muted">Add an extra layer of security to your account.</p>
                <button class="btn btn-outline-secondary" disabled>Coming Soon</button>
              </div>
              
              <div class="mb-4">
                <h6>Login Sessions</h6>
                <p class="text-muted">Manage your active login sessions.</p>
                <button class="btn btn-outline-secondary" disabled>Coming Soon</button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Notification Settings -->
        <div class="tab-pane fade" id="notifications">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Notification Settings</h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="emailNotifications" checked>
                  <label class="form-check-label" for="emailNotifications">
                    Email Notifications
                  </label>
                </div>
                <small class="text-muted">Receive email notifications for important updates.</small>
              </div>
              
              <div class="mb-3">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="bookingNotifications" checked>
                  <label class="form-check-label" for="bookingNotifications">
                    Booking Notifications
                  </label>
                </div>
                <small class="text-muted">Get notified when someone books your listing.</small>
              </div>
              
              <div class="mb-3">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="reviewNotifications" checked>
                  <label class="form-check-label" for="reviewNotifications">
                    Review Notifications
                  </label>
                </div>
                <small class="text-muted">Get notified when someone reviews your listing.</small>
              </div>
              
              <button class="btn btn-primary">Save Notification Settings</button>
            </div>
          </div>
        </div>
        
        <!-- Privacy Settings -->
        <div class="tab-pane fade" id="privacy">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Privacy Settings</h5>
            </div>
            <div class="card-body">
              <div class="mb-3">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="profileVisibility" checked>
                  <label class="form-check-label" for="profileVisibility">
                    Public Profile
                  </label>
                </div>
                <small class="text-muted">Allow others to view your profile information.</small>
              </div>
              
              <div class="mb-3">
                <div class="form-check form-switch">
                  <input class="form-check-input" type="checkbox" id="showEmail" checked>
                  <label class="form-check-label" for="showEmail">
                    Show Email to Hosts
                  </label>
                </div>
                <small class="text-muted">Allow hosts to see your email address.</small>
              </div>
              
              <div class="mb-4">
                <h6>Account Deletion</h6>
                <p class="text-muted">Permanently delete your account and all associated data.</p>
                <button class="btn btn-outline-danger" onclick="confirmDelete()">Delete Account</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
// Form validation
(function() {
  'use strict';
  window.addEventListener('load', function() {
    var forms = document.getElementsByClassName('needs-validation');
    var validation = Array.prototype.filter.call(forms, function(form) {
      form.addEventListener('submit', function(event) {
        if (form.checkValidity() === false) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  }, false);
})();

// Account deletion confirmation
function confirmDelete() {
  if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
    if (confirm('This will permanently delete all your data including listings, reviews, and account information. Are you absolutely sure?')) {
      window.location.href = '/profile/delete';
    }
  }
}
</script> 